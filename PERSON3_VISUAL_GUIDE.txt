/*
Author: Person 3
Class: ECE6122
Last Date Modified: November 29, 2025

Description:
Visual diagrams and flowcharts for Person 3 implementation
*/

===============================================================================
PERSON 3 IMPLEMENTATION - VISUAL GUIDE
===============================================================================

1. OVERALL SYSTEM ARCHITECTURE
===============================================================================

                         GaTech Buzzy Bowl Simulation
                                     |
                    +----------------+----------------+
                    |                |                |
             PERSON 1          PERSON 2          PERSON 3
           (Architect)        (Physicist)         (Pilot)
                |                  |                  |
        +--------------+   +---------------+   +----------------+
        | Render Loop  |   | updateKine-   |   | State Machine  |
        | (30ms)       |   | matics        |   | + PID Control  |
        |              |   | (10ms)        |   | (10ms)         |
        | - Draw UAVs  |   |               |   |                |
        | - Draw Field |   | - F = ma      |   | - IDLE         |
        | - Camera     |   | - x = x0+v*t  |   | - ASCENT       |
        |              |   | - Collisions  |   | - ORBIT        |
        +--------------+   +---------------+   +----------------+
                |                  |                  |
                +------------------+------------------+
                           |
                    ECE_UAV Objects
                    (15 threads)


2. PERSON 3 STATE MACHINE FLOW
===============================================================================

    START
      |
      v
  ┌─────────────────────────────────────────────────────────────┐
  │ IDLE STATE (0-5 seconds)                                    │
  │ ┌─────────────────────────────────────────────────────────┐ │
  │ │ Force = (0, 0, 10) N                                    │ │
  │ │ Velocity = (0, 0, 0)                                    │ │
  │ │ Wait for elapsedTime >= 5.0                             │ │
  │ └─────────────────────────────────────────────────────────┘ │
  └──────────────────────────┬──────────────────────────────────┘
                             │ elapsedTime >= 5.0
                             v
  ┌─────────────────────────────────────────────────────────────┐
  │ ASCENT STATE                                                │
  │ ┌─────────────────────────────────────────────────────────┐ │
  │ │ Target = (0, 0, 50)                                     │ │
  │ │ Direction = (target - position).normalized()            │ │
  │ │                                                          │ │
  │ │ IF velocity.magnitude() < 2.0 m/s:                      │ │
  │ │    Force = direction * 20 N                             │ │
  │ │ ELSE:                                                    │ │
  │ │    Force = braking force                                │ │
  │ │                                                          │ │
  │ │ Check: distance to (0,0,50) <= 10m ?                    │ │
  │ └─────────────────────────────────────────────────────────┘ │
  └──────────────────────────┬──────────────────────────────────┘
                             │ distance <= 10m
                             v
  ┌─────────────────────────────────────────────────────────────┐
  │ ORBIT STATE (60 seconds)                                    │
  │ ┌─────────────────────────────────────────────────────────┐ │
  │ │ Center = (0, 0, 50)                                     │ │
  │ │ Radius = 10 m                                           │ │
  │ │                                                          │ │
  │ │ [PID CONTROLLER]                                        │ │
  │ │ error = 10.0 - distance(position, center)               │ │
  │ │ radialForce = PID.calculate(10.0, currentRadius, dt)    │ │
  │ │                                                          │ │
  │ │ [TANGENTIAL MOVEMENT]                                   │ │
  │ │ tangentForce = randomDirection * speedControl           │ │
  │ │                                                          │ │
  │ │ [TOTAL FORCE]                                           │ │
  │ │ Force = radial + tangent + (0,0,10)                     │ │
  │ │                                                          │ │
  │ │ Check: orbitTime >= 60.0 seconds ?                      │ │
  │ └─────────────────────────────────────────────────────────┘ │
  └──────────────────────────┬──────────────────────────────────┘
                             │ orbitTime >= 60.0
                             v
  ┌─────────────────────────────────────────────────────────────┐
  │ FINISHED STATE                                              │
  │ ┌─────────────────────────────────────────────────────────┐ │
  │ │ Force = (0, 0, 10) N                                    │ │
  │ │ Hover in place                                          │ │
  │ └─────────────────────────────────────────────────────────┘ │
  └─────────────────────────────────────────────────────────────┘


3. PID CONTROLLER OPERATION
===============================================================================

                            Input: Setpoint (desired radius = 10m)
                                   Process Variable (actual radius)
                                   Delta Time (0.01s)
                                          |
                     +--------------------+--------------------+
                     |                                         |
                     v                                         |
              +-------------+                                  |
              | Error Calc  |                                  |
              | error =     |                                  |
              | setpoint -  |                                  |
              | measured    |                                  |
              +------+------+                                  |
                     |                                         |
        +------------+------------+                            |
        |            |            |                            |
        v            v            v                            |
  +-----------+-----------+-----------+                        |
  |Proportional| Integral |Derivative |                        |
  +-----------+-----------+-----------+                        |
  | P = Kp*e  | I = Ki*Σe | D = Kd*Δe |                       |
  | Kp = 50.0 | Ki = 0.5  | Kd = 10.0 |                       |
  +-----------+-----------+-----------+                        |
        |            |            |                            |
        +------------+------------+                            |
                     |                                         |
                     v                                         |
              +-------------+                                  |
              |  Sum Terms  |                                  |
              | output =    |                                  |
              |  P + I + D  |                                  |
              +------+------+                                  |
                     |                                         |
                     v                                         |
              Control Force (radial correction)               |
                     |                                         |
                     +-----------------------------------------+
                                    Feedback Loop


4. SPHERE ORBIT GEOMETRY
===============================================================================

                          Z-axis (up)
                              ^
                              |
                              |   
                         (0,0,60)  <-- Top of sphere
                              |
                              |
                    .---------+---------.
                 .'           |           '.
               .'      +------+------+      '.
             .'        |    (0,0,50) |        '.   Sphere Center
            /          |   Radius=10m |          \
           |           +------+------+           |
           |          /       |       \          |
           |         /        |        \         |  <- UAV orbit path
           |   UAV  *         |         *        |     (random tangent)
           |       /          |          \       |
            \     /           |           \     /
             '. /             |             \ .'
               X--------------+------------ --X
             .'               |               '.
           Y-axis       (0,0,40)                X-axis
                      Bottom of sphere

    UAV Position = (x, y, z)
    Radial Vector = (x, y, z-50)
    Distance = sqrt(x² + y² + (z-50)²)
    
    PID Goal: Keep Distance = 10m
    Tangent Plane: Perpendicular to radial vector


5. THREAD EXECUTION TIMELINE
===============================================================================

Time:    0ms     10ms    20ms    30ms    40ms    50ms    60ms    ...
         |       |       |       |       |       |       |
Thread1: [STATE][STATE][STATE][STATE][STATE][STATE][STATE]...
Thread2: [STATE][STATE][STATE][STATE][STATE][STATE][STATE]...
...
Thread15:[STATE][STATE][STATE][STATE][STATE][STATE][STATE]...
         |       |       |   RENDER    |       |   RENDER
         |       |       |      ↓      |       |      ↓
MainThd: [RENDER]       [getPos]      [       [getPos]...
                         getColor             getColor

Legend:
[STATE] = Calculate state-based force (Person 3)
          Update kinematics (Person 2)
          Check collisions (Person 2)

RENDER  = Poll all UAVs for position (Person 1)
          Render scene (Person 1)


6. FORCE VECTOR COMPOSITION
===============================================================================

                   ORBIT STATE FORCE COMPOSITION

    Total Force = Radial + Tangent + Gravity Compensation
                     ↓        ↓              ↓
                   [PID]  [Random]       [Constant]
                            
         
         Z (up)
         ^
         |         
         |         * UAV
         |        /|\
         |       / | \
         |      /  |  \_____ Tangent Force (random direction)
         |     /   |
         |    /    |_____ Radial Force (PID correction)
         |   /
         |  /_____ Gravity Compensation (0, 0, 10)
         |
         +-------------------------> X,Y (horizontal)
                   
                   Sphere Center
                      (0,0,50)


    Radial Force:
    - Points toward/away from center
    - Magnitude from PID calculation
    - Keeps UAV on sphere surface
    
    Tangent Force:
    - Perpendicular to radial
    - Random direction changes
    - Creates interesting flight paths
    
    Gravity Compensation:
    - Constant (0, 0, 10) N
    - Counters gravitational pull
    - Prevents falling


7. COLOR OSCILLATION WAVEFORM (ECE6122)
===============================================================================

    Intensity
    1.0 ┤                 ╱╲                 ╱╲
        │                ╱  ╲               ╱  ╲
    0.75┤   ──────╲    ╱    ╲    ╱────────╱    ╲    ╱
        │          ╲  ╱      ╲  ╱              ╲  ╱
    0.5 ┤           ╲╱        ╲╱                ╲╱
        │
        └───┬────────┬────────┬────────┬────────┬──> Time
            0       1sec     2sec     3sec     4sec

    Formula: intensity = 0.75 + 0.25 * sin(π*t)
    Frequency: 0.5 Hz (0.5 cycles per second)
    Period: 2 seconds per complete cycle
    Range: [0.5, 1.0]
    
    At t=0s:   intensity = 0.75 + 0.25*sin(0)   = 0.75 (mid)
    At t=0.5s: intensity = 0.75 + 0.25*sin(π/2) = 1.0  (peak)
    At t=1.0s: intensity = 0.75 + 0.25*sin(π)   = 0.75 (mid)
    At t=1.5s: intensity = 0.75 + 0.25*sin(3π/2)= 0.5  (trough)
    At t=2.0s: intensity = 0.75 + 0.25*sin(2π)  = 0.75 (mid)


8. DATA FLOW DIAGRAM
===============================================================================

    ECE_UAV Thread (10ms loop)
    ┌────────────────────────────────────────────────────────┐
    │                                                        │
    │  ┌──────────────────────────────────────────────┐    │
    │  │ PERSON 3: calculateStateBasedForce()         │    │
    │  │                                              │    │
    │  │  1. Get elapsed time                         │    │
    │  │  2. Determine current state                  │    │
    │  │  3. Update color phase                       │    │
    │  │  4. Calculate force based on state:          │    │
    │  │     - IDLE: Counter gravity                  │    │
    │  │     - ASCENT: Fly to target                  │    │
    │  │     - ORBIT: PID + tangent                   │    │
    │  │     - FINISHED: Hover                        │    │
    │  │  5. Return force vector                      │    │
    │  └──────────────┬───────────────────────────────┘    │
    │                 │                                     │
    │                 v (Vec3 force)                        │
    │  ┌──────────────────────────────────────────────┐    │
    │  │ PERSON 2: updateKinematics(force, dt)        │    │
    │  │                                              │    │
    │  │  1. Total force = control + gravity          │    │
    │  │  2. Acceleration = force / mass              │    │
    │  │  3. Update velocity                          │    │
    │  │  4. Update position                          │    │
    │  └──────────────┬───────────────────────────────┘    │
    │                 │                                     │
    │                 v                                     │
    │  ┌──────────────────────────────────────────────┐    │
    │  │ PERSON 2: checkCollisionsFor(this)           │    │
    │  │                                              │    │
    │  │  1. Check distance to other UAVs             │    │
    │  │  2. If collision: swap velocities            │    │
    │  └──────────────────────────────────────────────┘    │
    │                                                        │
    │  Sleep 10ms and repeat                                │
    └────────────────────────────────────────────────────────┘
    
    Main Thread (30ms loop)
    ┌────────────────────────────────────────────────────────┐
    │                                                        │
    │  ┌──────────────────────────────────────────────┐    │
    │  │ PERSON 1: Render Loop                        │    │
    │  │                                              │    │
    │  │  For each UAV:                               │    │
    │  │    position = uav->getPosition()             │    │
    │  │    intensity = uav->getColorIntensity()      │    │
    │  │    color = baseColor * intensity             │    │
    │  │    drawUAV(position, color)                  │    │
    │  │                                              │    │
    │  │  drawFootballField()                         │    │
    │  │  swapBuffers()                               │    │
    │  └──────────────────────────────────────────────┘    │
    │                                                        │
    │  Sleep until next frame                               │
    └────────────────────────────────────────────────────────┘


9. FILE STRUCTURE
===============================================================================

FinalProject_AdvComp/
├── code/
│   ├── PIDController.h          ← NEW (Person 3)
│   ├── PIDController.cpp        ← NEW (Person 3)
│   ├── ECE_UAV.h                ← MODIFIED (Person 3)
│   ├── ECE_UAV.cpp              ← MODIFIED (Person 3)
│   ├── Vec3.h                   (Existing)
│   ├── PhysicsGlobals.h         (Existing)
│   └── main.cpp                 (Person 1)
│
├── PERSON3_README.md            ← NEW (Person 3)
├── PERSON3_IMPLEMENTATION.txt   ← NEW (Person 3)
├── PERSON3_QUICK_REFERENCE.txt  ← NEW (Person 3)
├── PERSON3_COLOR_EXAMPLE.cpp    ← NEW (Person 3)
└── PERSON3_VISUAL_GUIDE.txt     ← NEW (This file)


10. INTEGRATION CHECKLIST
===============================================================================

PERSON 1 MUST:
-------------
☐ Initialize all 15 ECE_UAV objects with starting positions
☐ Populate GLOBAL_UAV_LIST with pointers to all UAVs
☐ Call uav->start() for each UAV to launch threads
☐ Poll uav->getPosition() every 30ms for rendering
☐ [ECE6122] Call uav->getColorIntensity() for color rendering

PERSON 2 MUST:
-------------
☐ Implement updateKinematics(force, dt) with F=ma
☐ Implement collision detection in checkCollisionsFor()
☐ Ensure thread-safe access to kinematic variables
☐ Handle elastic collisions (velocity swap)

PERSON 3 PROVIDES:
-----------------
☑ PID controller implementation
☑ State machine logic
☑ Force calculation function
☑ Color oscillation (ECE6122)
☑ Complete documentation

===============================================================================
END OF VISUAL GUIDE
===============================================================================
